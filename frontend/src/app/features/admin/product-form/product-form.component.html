<div class="form-container">
    <div class="form-header">
        <button mat-icon-button routerLink="/admin" matTooltip="Back to Dashboard">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <div>
            <h1>{{ isEditMode ? 'Edit Product' : 'Create New Product' }}</h1>
            <p class="subtitle">{{ isEditMode ? 'Update product details and inventory' : 'Add a new product to your
                catalog' }}</p>
        </div>
    </div>

    @if (errorMessage) {
    <div class="error-banner">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage }}</span>
    </div>
    }

    <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form-grid">

        <!-- Left Column: Main Info -->
        <div class="main-column">
            <!-- Basic Details Card -->
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Basic Information</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Product Name</mat-label>
                        <input matInput formControlName="name" placeholder="Ex. Wireless Headphones">
                        <mat-error *ngIf="productForm.get('name')?.hasError('required')">Product name is
                            required</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Description</mat-label>
                        <textarea matInput formControlName="description" rows="6"
                            placeholder="Detailed product description..."></textarea>
                        <mat-error *ngIf="productForm.get('description')?.hasError('required')">Description is
                            required</mat-error>
                    </mat-form-field>
                </mat-card-content>
            </mat-card>

            <!-- Media Card -->
            <mat-card class="mt-4">
                <mat-card-header>
                    <mat-card-title>Media</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Image URL</mat-label>
                        <input matInput formControlName="imageUrl" placeholder="https://example.com/image.jpg">
                        <mat-icon matSuffix>image</mat-icon>
                        <mat-hint>Provide a direct link to the product image</mat-hint>
                    </mat-form-field>

                    @if (productForm.get('imageUrl')?.value) {
                    <div class="image-preview">
                        <img [src]="productForm.get('imageUrl')?.value" alt="Preview"
                            onerror="this.onerror=null;this.src='https://placehold.co/400?text=No+Image';">
                    </div>
                    }
                </mat-card-content>
            </mat-card>
        </div>

        <!-- Right Column: Settings, Pricing, Inventory -->
        <div class="side-column">
            <!-- Organization Card -->
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Organization</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>SKU</mat-label>
                        <input matInput formControlName="sku" placeholder="Ex. WH-1000XM4">
                        <mat-error *ngIf="productForm.get('sku')?.hasError('required')">SKU is required</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Category</mat-label>
                        <mat-select formControlName="categoryId">
                            @for (category of categories(); track category.id) {
                            <mat-option [value]="category.id">{{ category.name }}</mat-option>
                            }
                        </mat-select>
                        <mat-error *ngIf="productForm.get('categoryId')?.hasError('required')">Category is
                            required</mat-error>
                    </mat-form-field>
                </mat-card-content>
            </mat-card>

            <!-- Pricing & Inventory Card -->
            <mat-card class="mt-4">
                <mat-card-header>
                    <mat-card-title>Pricing & Inventory</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Price</mat-label>
                        <span matTextPrefix>â‚¹&nbsp;</span>
                        <input matInput type="number" formControlName="price" placeholder="0.00">
                        <mat-error *ngIf="productForm.get('price')?.hasError('min')">Price must be
                            non-negative</mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Stock Quantity</mat-label>
                        <input matInput type="number" formControlName="stockQuantity" placeholder="0">
                        <mat-error *ngIf="productForm.get('stockQuantity')?.hasError('min')">Stock cannot be
                            negative</mat-error>
                    </mat-form-field>
                </mat-card-content>
            </mat-card>
        </div>

    </form>

    <div class="form-actions-bar">
        <button mat-button type="button" routerLink="/admin">Cancel</button>
        <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="loading || productForm.invalid">
            {{ loading ? 'Saving...' : (isEditMode ? 'Update Product' : 'Create Product') }}
        </button>
    </div>
</div>